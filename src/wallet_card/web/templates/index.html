<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Wallet Card Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .form-container {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="url"],
        input[type="file"],
        input[type="color"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .file-upload {
            padding: 20px;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f5f5f5;
        }

        .file-upload input {
            display: none;
        }

        .file-upload-label {
            cursor: pointer;
            color: #667eea;
            font-weight: 600;
        }

        .color-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.error {
            background: #fee;
            color: #c33;
            border: 1px solid #fcc;
        }

        .alert.success {
            background: #efe;
            color: #3c3;
            border: 1px solid #cfc;
        }

        .download-link {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 24px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #667eea;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .template-selection {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .template-option {
            position: relative;
        }

        .template-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .template-label {
            display: block;
            cursor: pointer;
        }

        .template-preview {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s;
            border: 3px solid transparent;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .template-preview strong {
            display: block;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .template-preview span {
            display: block;
            font-size: 0.85em;
            opacity: 0.9;
        }

        .template-option input[type="radio"]:checked + .template-label .template-preview {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
            transform: scale(1.02);
        }

        .template-option:hover .template-preview {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        @media (max-width: 600px) {
            .template-selection {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí≥ Wallet Card Generator</h1>
            <p>Create your Apple Wallet Digital Business Card</p>
        </div>

        <div class="form-container">
            <div id="alert" class="alert"></div>

            <form id="cardForm">
                <div class="section">
                    <div class="section-title">Choose Your Style</div>
                    <div class="template-selection">
                        <div class="template-option">
                            <input type="radio" id="classic-blue" name="template_style" value="classic-blue" checked>
                            <label for="classic-blue" class="template-label">
                                <div class="template-preview" style="background: rgb(0,77,153); color: white;">
                                    <strong>Classic Blue</strong>
                                    <span>Professional & Trustworthy</span>
                                </div>
                            </label>
                        </div>
                        <div class="template-option">
                            <input type="radio" id="modern-dark" name="template_style" value="modern-dark">
                            <label for="modern-dark" class="template-label">
                                <div class="template-preview" style="background: rgb(30,30,30); color: white;">
                                    <strong>Modern Dark</strong>
                                    <span>Sleek & Contemporary</span>
                                </div>
                            </label>
                        </div>
                        <div class="template-option">
                            <input type="radio" id="professional-green" name="template_style" value="professional-green">
                            <label for="professional-green" class="template-label">
                                <div class="template-preview" style="background: rgb(34,139,34); color: white;">
                                    <strong>Professional Green</strong>
                                    <span>Fresh & Growth-Oriented</span>
                                </div>
                            </label>
                        </div>
                        <div class="template-option">
                            <input type="radio" id="elegant-purple" name="template_style" value="elegant-purple">
                            <label for="elegant-purple" class="template-label">
                                <div class="template-preview" style="background: rgb(138,43,226); color: white;">
                                    <strong>Elegant Purple</strong>
                                    <span>Creative & Sophisticated</span>
                                </div>
                            </label>
                        </div>
                        <div class="template-option">
                            <input type="radio" id="bold-red" name="template_style" value="bold-red">
                            <label for="bold-red" class="template-label">
                                <div class="template-preview" style="background: rgb(178,34,34); color: white;">
                                    <strong>Bold Red</strong>
                                    <span>Energetic & Attention-Grabbing</span>
                                </div>
                            </label>
                        </div>
                        <div class="template-option">
                            <input type="radio" id="minimalist-light" name="template_style" value="minimalist-light">
                            <label for="minimalist-light" class="template-label">
                                <div class="template-preview" style="background: rgb(255,255,255); color: black; border: 2px solid #e0e0e0;">
                                    <strong>Minimalist Light</strong>
                                    <span>Clean & Simple</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">Personal Information</div>
                    <div class="form-group">
                        <label for="name">Name *</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="title">Title</label>
                        <input type="text" id="title" name="title">
                    </div>
                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone</label>
                        <input type="tel" id="phone" name="phone">
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">Links & Social</div>
                    <div class="form-group">
                        <label for="website">Website</label>
                        <input type="url" id="website" name="website" placeholder="https://example.com">
                    </div>
                    <div class="form-group">
                        <label for="linkedin">LinkedIn</label>
                        <input type="text" id="linkedin" name="linkedin" placeholder="linkedin.com/in/yourprofile">
                    </div>
                    <div class="form-group">
                        <label for="github">GitHub</label>
                        <input type="text" id="github" name="github" placeholder="github.com/yourusername">
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">Assets</div>
                    <div class="form-group">
                        <label>Icon (180x180)</label>
                        <div class="file-upload">
                            <input type="file" id="icon" name="icon" accept="image/*">
                            <label for="icon" class="file-upload-label">Choose Icon Image</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Logo (320x100)</label>
                        <div class="file-upload">
                            <input type="file" id="logo" name="logo" accept="image/*">
                            <label for="logo" class="file-upload-label">Choose Logo Image</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Photo (320x320)</label>
                        <div class="file-upload">
                            <input type="file" id="photo" name="photo" accept="image/*">
                            <label for="photo" class="file-upload-label">Choose Photo</label>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">Card Appearance</div>
                    <div class="form-group">
                        <label for="organizationName">Organization Name</label>
                        <input type="text" id="organizationName" name="organizationName">
                    </div>
                    <div class="form-group">
                        <label for="description">Description</label>
                        <input type="text" id="description" name="description">
                    </div>
                    <div class="form-group color-inputs">
                        <div>
                            <label for="backgroundColor">Background Color</label>
                            <input type="color" id="backgroundColor" name="backgroundColor" value="#004d99">
                        </div>
                        <div>
                            <label for="foregroundColor">Foreground Color</label>
                            <input type="color" id="foregroundColor" name="foregroundColor" value="#ffffff">
                        </div>
                        <div>
                            <label for="labelColor">Label Color</label>
                            <input type="color" id="labelColor" name="labelColor" value="#ffffff">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Output Type</label>
                    <div style="display: flex; gap: 20px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="output_type" value="wallet" checked style="width: auto; margin-right: 8px;">
                            <span>Wallet Pass (.pkpass)</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="output_type" value="qr" style="width: auto; margin-right: 8px;">
                            <span>QR Code (Works on all devices!)</span>
                        </label>
                    </div>
                    <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                        üí° <strong>QR Code</strong> links to Wallet pass - works on same WiFi network<br>
                        üîÑ <strong>For sharing:</strong> Host .pkpass on public server (Vercel/Netlify) and update URL
                    </p>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">Generate Card</button>

                <div class="section">
                    <div class="section-title">üéØ How to Add to Apple Wallet</div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 15px;">
                        <h4 style="margin: 0 0 15px 0; color: #28a745;">‚úÖ 100% Reliable Methods</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div style="text-align: center;">
                                <strong>üì± Direct Transfer</strong><br>
                                <small>AirDrop or Email the .pkpass file</small>
                            </div>
                            <div style="text-align: center;">
                                <strong>üåê Public Hosting</strong><br>
                                <small>Upload to Vercel/Netlify</small>
                            </div>
                        </div>
                        <hr style="margin: 15px 0; border: none; border-top: 1px solid #dee2e6;">
                        <h4 style="margin: 15px 0 10px 0; color: #dc3545;">‚ùå iOS 17+ Blocks</h4>
                        <div style="text-align: center;">
                            <strong>Self-signed certificates from web servers</strong><br>
                            <small>QR code works on same network, but web serving is blocked</small>
                        </div>
                    </div>
                </div>
            </form>

            <div id="downloadContainer" style="display: none;">
                <div id="walletPassSection" style="display: none;">
                    <a href="#" id="downloadLink" class="download-link" target="_blank">üì± Open .pkpass File</a>
                    <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                        <strong>On iPhone:</strong> Opens in Safari ‚Üí "Add to Wallet"<br>
                        <strong>On Mac:</strong> Opens in Wallet app automatically<br>
                        <small style="color: #dc3545;">‚ö†Ô∏è iOS 17+ may block self-signed certificates</small>
                    </p>
                </div>

                <div id="qrCodeSection" style="display: none;">
                    <a href="#" id="qrDownloadLink" class="download-link" target="_blank">üì∏ Download QR Code</a>
                    <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                        <strong>Print or share this QR code</strong><br>
                        When scanned on iPhone: Opens pass ‚Üí "Add to Wallet"<br>
                        <small style="color: #28a745;">‚úÖ Works reliably on same WiFi network</small>
                    </p>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #007bff;">
                    <h4 style="margin: 0 0 10px 0; color: #007bff;">üí° Best Methods for iPhone</h4>
                    <ol style="margin: 0; padding-left: 20px; font-size: 0.9em;">
                        <li><strong>AirDrop:</strong> Share file directly to iPhone</li>
                        <li><strong>Email:</strong> Attach .pkpass and send to yourself</li>
                        <li><strong>Public hosting:</strong> Upload to Vercel/Netlify and share link</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('cardForm');
        const alertDiv = document.getElementById('alert');
        const submitBtn = document.getElementById('submitBtn');
        const downloadContainer = document.getElementById('downloadContainer');
        const downloadLink = document.getElementById('downloadLink');

        function showAlert(message, type) {
            alertDiv.textContent = message;
            alertDiv.className = `alert ${type}`;
            alertDiv.style.display = 'block';
        }

        function hideAlert() {
            alertDiv.style.display = 'none';
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideAlert();

            submitBtn.disabled = true;
            submitBtn.textContent = 'Generating...';

            const formData = new FormData(form);

            // Show appropriate download section based on output type
            const outputType = document.querySelector('input[name="output_type"]:checked').value;

            // Convert color inputs to RGB format
            const bgColor = hexToRgb(formData.get('backgroundColor'));
            const fgColor = hexToRgb(formData.get('foregroundColor'));
            const labelColor = hexToRgb(formData.get('labelColor'));

            formData.set('backgroundColor', `rgb(${bgColor.r},${bgColor.g},${bgColor.b})`);
            formData.set('foregroundColor', `rgb(${fgColor.r},${fgColor.g},${fgColor.b})`);
            formData.set('labelColor', `rgb(${labelColor.r},${labelColor.g},${labelColor.b})`);

            // Set QR data to website if provided
            if (formData.get('website')) {
                formData.set('qr_data', formData.get('website'));
            }

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('‚úÖ Wallet card generated successfully!', 'success');
                    downloadLink.href = data.download_url;
                    downloadLink.download = data.filename;
                    downloadContainer.style.display = 'block';
                } else {
                    showAlert('‚ùå Error: ' + (data.errors ? data.errors.join(', ') : 'Unknown error'), 'error');
                }
            } catch (error) {
                showAlert('‚ùå Error: ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Generate Wallet Card';
            }
        });

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 0, g: 0, b: 0 };
        }

        // Template color presets
        const templateColors = {
            'classic-blue': {
                bg: '#004d99',
                fg: '#ffffff',
                label: '#ffffff'
            },
            'modern-dark': {
                bg: '#1e1e1e',
                fg: '#ffffff',
                label: '#c8c8c8'
            },
            'professional-green': {
                bg: '#228b22',
                fg: '#ffffff',
                label: '#ffffff'
            },
            'elegant-purple': {
                bg: '#8a2be2',
                fg: '#ffffff',
                label: '#ffffff'
            },
            'bold-red': {
                bg: '#b22222',
                fg: '#ffffff',
                label: '#ffffff'
            },
            'minimalist-light': {
                bg: '#ffffff',
                fg: '#000000',
                label: '#646464'
            }
        };

        // Update colors when template is selected
        document.querySelectorAll('input[name="template_style"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const colors = templateColors[this.value];
                if (colors) {
                    document.getElementById('backgroundColor').value = colors.bg;
                    document.getElementById('foregroundColor').value = colors.fg;
                    document.getElementById('labelColor').value = colors.label;
                }
            });
        });
    </script>
</body>
</html>

